<!doctype html>
<html lang="bn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>লগইন করুন - Riseii</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
                :root {
            --primary-blue: #007aff;
            --dark-blue: #0d1a2e;
            --bg-light: #f8f9fa;
            --border-color: #e5e7eb;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --white: #ffffff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Hind Siliguri', sans-serif; background-color: var(--white); color: var(--text-dark); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
        .section { padding: 80px 0; }
        .text-center { text-align: center; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 8px; font-weight: 600; text-decoration: none; transition: all 0.3s ease; border: 1px solid transparent; }
        .btn-dark { background-color: var(--dark-blue); color: var(--white); }
        .btn-dark:hover { background-color: #2c3e50; }
        .btn-light { background: var(--white); color: var(--dark-blue); border-color: var(--border-color); }
        .btn-light:hover { background-color: var(--bg-light); }
        
        /* Header */
        .site-header { background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border-color); }
        .header-container { display: flex; justify-content: space-between; align-items: center; height: 70px; }
        .logo a { font-size: 24px; font-weight: 700; color: var(--primary-blue); text-decoration: none; margin-left: 5%; }
        .nav-menu { list-style: none; display: flex; align-items: center; gap: 2.5rem; margin-right: 5%; }
        .nav-menu a { text-decoration: none; color: var(--text-dark); font-weight: 500; }
       .action-btn { display: flex; gap: 16px; }
        .menu-toggle { display: none; background: none; border: none; font-size: 24px; color: var(--text-dark); cursor: pointer; }


        /* --- Main Content & Login Form --- */
        main { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 3rem 1rem; }
        .login-container { max-width: 420px; width: 100%; background: var(--primary-color); padding: 40px; border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 10px 30px var(--shadow-color); text-align: center; }
        .login-container h2 { color: var(--text-color); font-size: 26px; font-weight: 600; margin-bottom: 25px; }
        .flash { padding: 1em; margin-bottom: 1.2em; border-radius: 6px; color: #fff; font-weight: 500; }
        .flash.error { background-color: var(--error-color); }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary-color); }
        .form-group input { width: 100%; padding: 14px; background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); font-size: 16px; }
        .form-group input:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px var(--accent-shadow-color); }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 17px; margin-top: 10px; display: flex; justify-content: center; align-items: center; gap: 10px; transition: all 0.3s ease; }
        .btn-primary { background-color: var(--accent-color); color: var(--bg-color); }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-google { background-color: transparent; color: var(--text-color); border: 1px solid var(--border-color); }
        .btn-google:hover { background-color: var(--border-color); }
        .divider { text-align: center; border-bottom: 1px solid var(--border-color); line-height: 0.1em; margin: 30px 0; color: var(--text-secondary-color); }
        .divider span { background: var(--primary-color); padding: 0 15px; }
        .signup-link { margin-top: 25px; color: var(--text-secondary-color); }
        .signup-link a { color: var(--accent-color); text-decoration: none; font-weight: 600; }

        /* --- Footer --- */
        .site-footer { background-color: var(--primary-color); color: var(--text-secondary-color); padding: 2rem; text-align: center; border-top: 1px solid var(--border-color); }
        .footer-bottom { margin-top: 1rem; border-top: 1px solid var(--border-color); padding-top: 1rem; font-size: 0.9rem; color: #777; }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="header-container">
            <div class="logo"><a href="{{ url_for('index') }}">Riseii</a></div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="{{ url_for('index') }}">হোম</a></li>
                    {% if is_logged_in %}
                        <li class="action-btn btn-dark"><a href="{{ url_for('dashboard') }}">ড্যাশবোর্ড</a></li>
                    {% else %}
                        <li class="action-btn btn-dark"><a href="{{ url_for('signup') }}">একাউন্ট খুলুন</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="login-container">
            <h2>আপনার একাউন্টে লগইন করুন</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}{% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}{% endif %}
            {% endwith %}
            <div id="client-message" class="flash" style="display: none;"></div>

            <form id="login-form">
                <div class="form-group">
                    <label for="email">ইমেইল</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">পাসওয়ার্ড</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" id="login-button" class="btn btn-primary">লগইন করুন</button>
            </form>
            
            <div class="divider"><span>অথবা</span></div>

            <button id="google-signin-btn" class="btn btn-google"><i class="fab fa-google"></i> Google দিয়ে চালিয়ে যান</button>
            <div class="signup-link">একাউন্ট নেই? <a href="{{ url_for('signup') }}">নতুন একাউন্ট খুলুন</a></div>
        </div>
    </main>
    
    <footer class="site-footer">
        <div class="footer-bottom">© 2025 Riseii. সর্বস্বত্ব সংরক্ষিত।</div>
    </footer>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script>
    
        // --- Firebase Configuration ---
        // This config object is populated by the server (app.py)
        const firebaseConfig = {
            apiKey: "{{ config.firebase_api_key }}",
            authDomain: "{{ config.firebase_auth_domain }}",
            projectId: "{{ config.firebase_project_id }}",
            messagingSenderId: "{{ config.firebase_messaging_sender_id }}",
            appId: "{{ config.firebase_app_id }}"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // --- DOM Elements ---
        const loginForm = document.getElementById('login-form');
        const loginButton = document.getElementById('login-button');
        const googleButton = document.getElementById('google-signin-btn');
        const clientMessage = document.getElementById('client-message');

        // --- Helper Function to show messages ---
        function showMessage(text, type = 'error') {
            clientMessage.textContent = text;
            clientMessage.className = `flash ${type}`;
            clientMessage.style.display = 'block';
        }

        // --- Helper function to handle server session creation ---
        function createServerSession(idToken) {
            return fetch('/api/set_session', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({idToken: idToken})
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.href = data.redirect_url;
                } else {
                    throw new Error(data.message || 'Server session could not be created.');
                }
            });
        }

        // --- Event Listener for Email/Password Login ---
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Disable button and show loading state
            loginButton.disabled = true;
            loginButton.textContent = 'প্রসেসিং...';
            clientMessage.style.display = 'none';

            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => userCredential.user.getIdToken())
                .then(idToken => createServerSession(idToken))
                .catch(error => {
                    // Handle login errors
                    let friendlyMessage = 'ভুল ইমেইল অথবা পাসওয়ার্ড।';
                    if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                        // Keep the message generic for security
                        friendlyMessage = 'আপনার দেওয়া ইমেইল বা পাসওয়ার্ডটি ভুল।';
                    }
                    showMessage(friendlyMessage, 'error');
                })
                .finally(() => {
                    // Re-enable button
                    loginButton.disabled = false;
                    loginButton.textContent = 'লগইন';
                });
        });

        // --- Event Listener for Google Sign-In ---
        googleButton.addEventListener('click', function() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then(result => result.user.getIdToken())
                .then(idToken => createServerSession(idToken))
                .catch(error => {
                    // Handle Google sign-in errors
                    console.error("Google Sign-In Error: ", error);
                    let friendlyMessage = 'Google দিয়ে লগইন করা সম্ভব হয়নি।';
                    if (error.code === 'auth/popup-closed-by-user') {
                        friendlyMessage = 'আপনি লগইন পপ-আপটি বন্ধ করে দিয়েছেন।';
                    }
                    showMessage(friendlyMessage, 'error');
                });
        });

    </script>
</body>
</html>
