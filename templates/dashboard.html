<!-- templates/dashboard.html এর আপডেট করা কোড -->
<!doctype html>
<html lang="bn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ড্যাশবোর্ড</title>
    <!-- এখানে আপনার CSS স্টাইলগুলো থাকবে -->
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; margin: 0; padding: 15px; }
        .container { max-width: 700px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .header h2 { margin: 0; color: #333; }
        .header .logout-btn { color: #1877f2; text-decoration: none; font-weight: bold; }
        .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; color: #1877f2; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .balance-card .balance-amount { font-size: 2.5em; font-weight: bold; color: #4CAF50; margin: 10px 0; }
        .referral-link { padding: 10px; background: #e9ebee; border: 1px dashed #ccc; border-radius: 4px; word-wrap: break-word; user-select: all; }
        .task-list a { text-decoration: none; }
        .task-item { display: block; background: #f7f7f7; padding: 15px; border-radius: 6px; margin-bottom: 10px; color: #333; transition: background-color 0.2s; }
        .task-item:hover { background-color: #e9ebee; }
        .task-history ul { list-style-type: none; padding: 0; }
        .task-history li { background: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- user অবজেক্ট আছে কিনা চেক করা হচ্ছে -->
            <h2>স্বাগতম, {{ user.name if user else 'Guest' }}!</h2>
            <a href="{{ url_for('logout') }}" class="logout-btn">লগআউট</a>
        </div>

        <div class="card balance-card">
            <h3>আপনার বর্তমান ব্যালেন্স</h3>
            <!-- user এবং user.balance আছে কিনা চেক করা হচ্ছে -->
            <p class="balance-amount">৳ {{ "%.2f"|format(user.balance) if user and user.balance is defined else '0.00' }}</p>
        </div>

        <div class="card">
            <h3>আপনার রেফারেল প্রোগ্রাম</h3>
            <p>আপনার বন্ধুদের এই লিঙ্কটি শেয়ার করুন। তারা জয়েন করলে আপনারা উভয়েই বোনাস পাবেন।</p>
            <!-- referral_link ভেরিয়েবল আছে কিনা চেক করা হচ্ছে -->
            {% if referral_link %}
                <p><strong>শেয়ার করার লিঙ্ক:</strong></p>
                <p class="referral-link">{{ referral_link }}</p>
            {% endif %}
        </div>

        <div class="card task-list">
            <h3>কাজ সমূহ (Available Tasks)</h3>
            <a href="{{ url_for('task_fb_post') }}">
                <div class="task-item">
                    <strong>ফেসবুক পোস্ট টাস্ক</strong> - আয় করুন ৳১০.০০
                </div>
            </a>
        </div>

        <div class="card task-history">
            <h3>আপনার কাজের ইতিহাস</h3>
            {% if task_history %}
                <ul>
                {% for task in task_history %}
                    <li>
                        <span>
                            <!-- submitted_at অবজেক্ট এবং strftime মেথড আছে কিনা চেক করা হচ্ছে -->
                            {% if task.submitted_at and task.submitted_at.strftime %}
                                {{ task.submitted_at.strftime('%d-%b-%Y') }}
                            {% else %}
                                Pending Date
                            {% endif %}
                            - {{ task.task_type or 'Unknown Task' }}
                        </span>
                        <span style="font-weight: bold; color: {% if task.status == 'completed' %}green{% elif task.status == 'pending' %}orange{% else %}red{% endif %};">
                            {{ (task.status or 'unknown')|capitalize }}
                        </span>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <p>আপনি এখনো কোনো কাজ সম্পন্ন করেননি।</p>
            {% endif %}
        </div>
    </div>

    <!-- dashboard.html ফাইলের body অংশে নিচের কার্ডগুলো যোগ করুন -->

<!-- ... (আগের প্রোফাইল, ব্যালেন্স, রেফারেল লিঙ্ক, টাস্ক লিস্ট কার্ডগুলো এখানে থাকবে) ... -->

<!-- নতুন: রেফারেল হিস্টোরি কার্ড -->
<div class="card">
    <h3>আপনার রেফারেল হিস্টোরি</h3>
    {% if my_referrals %}
        <table class="history-table">
            <thead>
                <tr>
                    <th>তারিখ</th>
                    <th>জয়েন করেছেন</th>
                    <th>বোনাস</th>
                </tr>
            </thead>
            <tbody>
            {% for referral in my_referrals %}
                <tr>
                    <td>
                        {% if referral.timestamp and referral.timestamp.strftime %}
                            {{ referral.timestamp.strftime('%d-%b-%Y') }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ referral.referred_user_email }}</td>
                    <td>৳ {{ "%.2f"|format(referral.reward_amount) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>আপনি এখনো কাউকে সফলভাবে রেফার করেননি।</p>
    {% endif %}
</div>

<!-- নতুন: ব্যালেন্স হিস্টোরি কার্ড -->
<div class="card">
    <h3>আপনার ব্যালেন্স হিস্টোরি</h3>
    {% if balance_history %}
        <table class="history-table">
            <thead>
                <tr>
                    <th>তারিখ</th>
                    <th>বিবরণ</th>
                    <th>পরিমাণ</th>
                </tr>
            </thead>
            <tbody>
            {% for entry in balance_history %}
                <tr>
                    <td>
                        {% if entry.timestamp and entry.timestamp.strftime %}
                            {{ entry.timestamp.strftime('%d-%b-%Y %H:%M') }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ entry.description }}</td>
                    <td style="color: green; font-weight: bold;">+ ৳ {{ "%.2f"|format(entry.amount) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>আপনার কোনো ব্যালেন্স লেনদেনের রেকর্ড নেই।</p>
    {% endif %}
</div>


<!-- dashboard.html ফাইলের <style> ট্যাগে নিচের CSS যোগ করুন -->
<style>
    /* ... (আপনার আগের সব CSS এখানে থাকবে) ... */
    
    .history-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    .history-table th, .history-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }
    .history-table th {
        background-color: #f7f7f7;
        font-weight: 600;
        color: #555;
    }
    .history-table tr:last-child td {
        border-bottom: none;
    }
</style>
</body>
</html>
